# Product Image Management - Test Plan

## 테스트 환경
- Flutter 3.10.8
- Dart SDK ^3.10.8
- Target: Android/iOS

## 1️⃣ 기본 이미지 업로드 테스트

### 1.1 카메라 업로드
- [ ] ProductFormModal 열기
- [ ] SKU 입력 (예: TEST001)
- [ ] 상품명 입력 (예: 테스트 상품)
- [ ] "카메라" 버튼 클릭
- [ ] 카메라 권한 승인
- [ ] 사진 촬영
- [ ] 이미지 크롭 UI 확인
- [ ] 크롭 완료 후 프리뷰 표시 확인
- [ ] 상품 저장 후 ProductManagementScreen에서 썸네일 확인
- [ ] PosMainScreen에서 상품 카드 이미지 확인

**예상 결과:**
- 이미지가 `app_documents/product_images/TEST001.jpg`에 저장
- 최대 800x800, 85% JPEG 품질로 리사이징
- DB에 imageUrl = 'product_images/TEST001.jpg' 저장

### 1.2 갤러리 업로드
- [ ] ProductFormModal 열기
- [ ] SKU 입력 (예: TEST002)
- [ ] 상품명 입력
- [ ] "갤러리" 버튼 클릭
- [ ] 갤러리 권한 승인
- [ ] 이미지 선택
- [ ] 이미지 크롭 UI 확인
- [ ] 크롭 완료 후 프리뷰 표시 확인
- [ ] 상품 저장 후 썸네일 확인

**예상 결과:**
- 갤러리에서 선택한 이미지가 저장되고 표시됨

### 1.3 이미지 삭제
- [ ] 이미지 있는 상품 편집
- [ ] "이미지 삭제" 버튼 클릭
- [ ] 확인 다이얼로그 표시
- [ ] "삭제" 클릭
- [ ] 이미지 프리뷰가 플레이스홀더로 변경
- [ ] 저장 후 DB에서 imageUrl = null 확인
- [ ] 파일 시스템에서 이미지 파일 삭제 확인

**예상 결과:**
- 이미지 완전 삭제, DB 및 파일 시스템 모두 제거

---

## 2️⃣ AI 자동 검색 테스트

### 2.1 개별 상품 AI 검색
- [ ] ProductFormModal 열기
- [ ] SKU 입력 (예: TEST003)
- [ ] 상품명 입력 (예: "organic apple")
- [ ] "AI 자동 검색" 버튼 클릭
- [ ] ImageSearchDialog 표시 확인
- [ ] 로딩 인디케이터 표시
- [ ] 5개 후보 이미지 그리드 표시
- [ ] 각 이미지에 출처/작가 표시 확인
- [ ] 이미지 선택
- [ ] 다운로드 진행
- [ ] 프리뷰 업데이트 확인
- [ ] 상품 저장

**예상 결과:**
- Unsplash API 호출 성공
- 5개 후보 이미지 표시
- 선택한 이미지 다운로드 및 저장
- 파일 크기 약 100KB 이하

### 2.2 API 에러 처리
- [ ] 네트워크 연결 끊기
- [ ] AI 검색 시도
- [ ] 에러 메시지 표시 확인
- [ ] "수동 업로드로 전환" 버튼 확인

**예상 결과:**
- 사용자 친화적 에러 메시지 표시
- 앱 크래시 없음

### 2.3 검색 결과 없음
- [ ] 존재하지 않는 상품명 입력 (예: "asdfqwerzxcv12345")
- [ ] AI 검색 시도
- [ ] "검색 결과가 없습니다" 메시지 확인

**예상 결과:**
- 빈 결과 처리 정상 동작

---

## 3️⃣ 일괄 처리 테스트

### 3.1 Batch Process 정상 동작
- [ ] 이미지 없는 상품 3개 생성
  - SKU: BATCH001, 상품명: "coffee"
  - SKU: BATCH002, 상품명: "tea"
  - SKU: BATCH003, 상품명: "juice"
- [ ] ProductManagementScreen AppBar의 "AI 이미지 검색" 버튼 클릭
- [ ] 처리 시작 확인
- [ ] 진행률 표시 (0/3 → 1/3 → 2/3 → 3/3)
- [ ] Rate limiting 확인 (각 요청 사이 1초 대기)
- [ ] 완료 다이얼로그 표시
- [ ] 성공/실패 통계 확인
- [ ] 성공률 표시 확인
- [ ] 리스트 갱신 후 썸네일 표시 확인

**예상 결과:**
- 3개 상품 모두 자동 이미지 할당
- 성공률 100% 표시
- Rate limiting으로 약 3초 소요

### 3.2 일부 실패 시나리오
- [ ] 이미지 없는 상품 생성 (존재하지 않는 상품명)
  - SKU: FAIL001, 상품명: "asdfqwerzxcv"
- [ ] Batch Process 실행
- [ ] 실패 상품 목록에 표시 확인
- [ ] 성공률 계산 정확성 확인

**예상 결과:**
- 실패 항목 리스트에 표시
- 정확한 통계 표시

### 3.3 이미지 없는 상품이 없을 때
- [ ] 모든 상품에 이미지 설정
- [ ] Batch Process 실행
- [ ] "이미지 없는 상품이 없습니다" 에러 메시지 확인

**예상 결과:**
- 친화적 안내 메시지 표시

---

## 4️⃣ UI 통합 테스트

### 4.1 ProductManagementScreen 썸네일
- [ ] 이미지 있는 상품 썸네일 표시 확인 (48x48)
- [ ] 이미지 없는 상품 플레이스홀더 아이콘 확인
- [ ] 로딩 중 CircularProgressIndicator 확인
- [ ] 이미지 로딩 실패 시 broken_image 아이콘 확인
- [ ] 스크롤 성능 확인 (100개 상품)

**예상 결과:**
- 썸네일 정상 표시
- 부드러운 스크롤

### 4.2 PosMainScreen 상품 카드
- [ ] 상품 카드 상단 이미지 영역 확인
- [ ] 이미지 있는 상품 이미지 표시
- [ ] 이미지 없는 상품 shopping_bag_outlined 아이콘
- [ ] 품절/재고부족 배지 오버레이 확인
- [ ] 그리드 스크롤 성능 확인

**예상 결과:**
- 카드 UI 정상 표시
- 배지와 이미지 레이어링 정상

### 4.3 반응형 레이아웃
- [ ] 태블릿 모드에서 UI 확인
- [ ] 모바일 모드에서 UI 확인
- [ ] 이미지 비율 유지 확인

**예상 결과:**
- 모든 화면 크기에서 정상 동작

---

## 5️⃣ 성능 테스트

### 5.1 이미지 로딩 성능
- [ ] 100개 상품 리스트 스크롤
- [ ] FPS 측정 (60fps 유지 확인)
- [ ] 메모리 사용량 확인

**목표:**
- 60fps 유지
- 메모리 200MB 이하

### 5.2 이미지 캐싱
- [ ] 상품 리스트 스크롤
- [ ] 다시 위로 스크롤
- [ ] 이미지 재로딩 없이 즉시 표시 확인

**예상 결과:**
- FutureBuilder 캐싱으로 즉시 표시

### 5.3 Rate Limiting
- [ ] Batch Process 10개 상품
- [ ] 각 요청 사이 1초 간격 확인
- [ ] Unsplash API 제한 초과 방지

**예상 결과:**
- 10개 처리 시 약 10초 소요
- API 제한 에러 없음

---

## 6️⃣ 엣지 케이스 테스트

### 6.1 SKU 중복
- [ ] 기존 SKU로 새 상품 생성
- [ ] 이미지 업로드
- [ ] 기존 이미지 덮어쓰기 확인

**예상 결과:**
- 새 이미지로 덮어쓰기

### 6.2 특수문자 SKU
- [ ] SKU에 특수문자 포함 (예: "TEST-001")
- [ ] 이미지 업로드
- [ ] 파일명 처리 확인

**예상 결과:**
- 파일 시스템 호환 가능한 이름으로 저장

### 6.3 매우 큰 이미지
- [ ] 4K (3840x2160) 이미지 업로드
- [ ] 800x800으로 리사이징 확인
- [ ] 파일 크기 확인 (~100KB)

**예상 결과:**
- 자동 리사이징 및 압축

### 6.4 상품 편집 중 이미지 변경
- [ ] 기존 상품 편집
- [ ] 이미지 변경
- [ ] 저장 취소
- [ ] 이미지 롤백 확인

**예상 결과:**
- 저장 전까지 DB 변경 없음

---

## 7️⃣ 권한 테스트

### 7.1 카메라 권한 거부
- [ ] 카메라 권한 거부
- [ ] "카메라" 버튼 클릭
- [ ] 권한 요청 다이얼로그 표시
- [ ] 거부 시 안내 메시지

**예상 결과:**
- 권한 에러 친화적 처리

### 7.2 갤러리 권한 거부
- [ ] 갤러리 권한 거부
- [ ] "갤러리" 버튼 클릭
- [ ] 권한 요청 다이얼로그 표시

**예상 결과:**
- 권한 에러 친화적 처리

---

## 8️⃣ 데이터 무결성 테스트

### 8.1 DB 동기화
- [ ] 이미지 업로드 후 DB 확인
- [ ] imageUrl 필드 정확성 확인
- [ ] updatedAt 타임스탬프 확인
- [ ] needsSync = true 확인

**예상 결과:**
- DB 필드 정확히 업데이트

### 8.2 파일 시스템 정리
- [ ] 상품 삭제
- [ ] 해당 이미지 파일 삭제 확인

**예상 결과:**
- 고아 파일 없음

---

## 테스트 결과 요약

| 카테고리 | 테스트 항목 | 통과/실패 | 비고 |
|---------|-----------|---------|------|
| 기본 업로드 | 카메라 | - | |
| 기본 업로드 | 갤러리 | - | |
| 기본 업로드 | 삭제 | - | |
| AI 검색 | 개별 검색 | - | API Key 필요 |
| AI 검색 | 에러 처리 | - | |
| AI 검색 | 빈 결과 | - | |
| 일괄 처리 | 정상 동작 | - | API Key 필요 |
| 일괄 처리 | 일부 실패 | - | |
| 일괄 처리 | 상품 없음 | - | |
| UI 통합 | 상품 관리 | - | |
| UI 통합 | POS 화면 | - | |
| UI 통합 | 반응형 | - | |
| 성능 | 로딩 | - | |
| 성능 | 캐싱 | - | |
| 성능 | Rate Limiting | - | |
| 엣지 케이스 | SKU 중복 | - | |
| 엣지 케이스 | 특수문자 | - | |
| 엣지 케이스 | 큰 이미지 | - | |
| 권한 | 카메라 | - | |
| 권한 | 갤러리 | - | |
| 데이터 | DB 동기화 | - | |
| 데이터 | 파일 정리 | - | |

---

## 중요 이슈

### 🔴 Critical
- **Unsplash API Key 설정 필요**
  - 파일: `lib/features/products/data/api/unsplash_api_client.dart`
  - 라인 12: `_accessKey` 값 변경
  - 발급: https://unsplash.com/developers
  - 무료 50 req/hour

### 🟡 Warning
- Android SDK 경로 설정 필요 (빌드 테스트용)
- 실제 디바이스 또는 에뮬레이터 필요

### 🟢 Info
- 모든 UI는 컴파일 성공
- 기존 기능과 충돌 없음
