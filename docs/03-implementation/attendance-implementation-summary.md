# ì§ì› ê·¼íƒœ ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„ ìš”ì•½

## ğŸ“… êµ¬í˜„ ì¼ì‹œ
2024ë…„ 2ì›” 7ì¼

## âœ… ì™„ë£Œëœ Phase

### Phase 1: ë°ì´í„°ë² ì´ìŠ¤ ë° DAO (ì™„ë£Œ)
### Phase 2: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì„œë¹„ìŠ¤ (ì™„ë£Œ)

---

## ğŸ“Š êµ¬í˜„ í˜„í™©

### Phase 1: ë°ì´í„°ë² ì´ìŠ¤ ë° DAO âœ…

#### 1. í…Œì´ë¸” ìƒì„±
- **`attendance_logs`**: ì¶œí‡´ê·¼ ê¸°ë¡
  - ì¶œê·¼/í‡´ê·¼ ì‹œê°„, ê·¼ë¬´ ì‹œê°„(ì´/ì •ê·œ/ì—°ì¥/ì•¼ê°„)
  - ìƒíƒœ(working/completed/absent), ì§€ê°/ì¡°í‡´ í”Œë˜ê·¸
  - ìœ„ì¹˜ ì •ë³´, ë©”ëª¨, ìŠ¹ì¸ ì •ë³´

- **`leave_requests`**: íœ´ê°€ ì‹ ì²­
  - íœ´ê°€ ìœ í˜•(ì—°ì°¨/ë³‘ê°€/ê°œì¸/ì¶œì‚°/ìœ¡ì•„/ë¬´ê¸‰)
  - ì‹ ì²­ ê¸°ê°„, ì¼ìˆ˜, ì‚¬ìœ 
  - ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš°(pending/approved/rejected/cancelled)

- **`work_schedules`**: ê·¼ë¬´ ìŠ¤ì¼€ì¤„
  - ìš”ì¼ë³„ ê·¼ë¬´ ì‹œê°„ (0=ì¼ìš”ì¼ ~ 6=í† ìš”ì¼)
  - ì‹œí”„íŠ¸ ìœ í˜•(day/night/off)
  - ìœ íš¨ ê¸°ê°„ ê´€ë¦¬

- **`leave_balances`**: íœ´ê°€ ì”ì—¬
  - ì—°ì°¨/ë³‘ê°€/ê°œì¸ ì‚¬ìœ ë³„ ì´ëŸ‰/ì‚¬ìš©/ì”ì—¬
  - ì—°ë„ë³„ ê´€ë¦¬

#### 2. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
- **Schema v6 â†’ v7**
- 4ê°œ í…Œì´ë¸” ìƒì„± ë° ì¸ë±ìŠ¤ ìµœì í™”
- ìë™ ì´ˆê¸° ë°ì´í„° ì‹œë”©:
  ```
  - ì—°ì°¨: 15ì¼
  - ë³‘ê°€: 5ì¼
  - ê°œì¸ ì‚¬ìœ : 3ì¼
  - ê¸°ë³¸ ìŠ¤ì¼€ì¤„: ì›”~ê¸ˆ 09:00~18:00, ì£¼ë§ íœ´ë¬´
  ```

#### 3. AttendanceDao êµ¬í˜„
**ì¶œí‡´ê·¼ ê¸°ë¡ ê´€ë¦¬:**
- `checkIn()`: ì¶œê·¼ ê¸°ë¡ ìƒì„±
- `checkOut()`: í‡´ê·¼ ê¸°ë¡ ì—…ë°ì´íŠ¸
- `getTodayAttendance()`: ì˜¤ëŠ˜ ì¶œê·¼ ê¸°ë¡ ì¡°íšŒ
- `isAlreadyCheckedIn()`: ì¤‘ë³µ ì¶œê·¼ ë°©ì§€
- `getActiveWorkingLog()`: í˜„ì¬ ê·¼ë¬´ ì¤‘ì¸ ê¸°ë¡ ì¡°íšŒ
- `getAttendanceByDateRange()`: ê¸°ê°„ë³„ ì¡°íšŒ
- `getAttendanceByMonth()`: ì›”ë³„ ì¡°íšŒ
- `getRecentAttendance()`: ìµœê·¼ ê¸°ë¡ ì¡°íšŒ
- `watchRecentAttendance()`: ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼

**í†µê³„ ê¸°ëŠ¥:**
- `getTotalWorkMinutesThisMonth()`: ì›”ê°„ ì´ ê·¼ë¬´ ì‹œê°„
- `getOvertimeMinutesThisMonth()`: ì›”ê°„ ì—°ì¥ ê·¼ë¬´ ì‹œê°„
- `getAttendanceStatsByStatus()`: ìƒíƒœë³„ í†µê³„
- `getLateCountThisMonth()`: ì›”ê°„ ì§€ê° íšŸìˆ˜

**íœ´ê°€ ê´€ë¦¬:**
- `createLeaveRequest()`: íœ´ê°€ ì‹ ì²­
- `updateLeaveRequestStatus()`: ìŠ¹ì¸/ê±°ì ˆ
- `getPendingLeaveRequests()`: ëŒ€ê¸° ì¤‘ì¸ ì‹ ì²­ ëª©ë¡
- `hasOverlappingApprovedLeave()`: ì¤‘ë³µ ê²€ì¦

**íœ´ê°€ ì”ì—¬ ê´€ë¦¬:**
- `getLeaveBalance()`: ì”ì—¬ ì¡°íšŒ
- `updateLeaveBalance()`: ì”ì—¬ì¼ ì°¨ê°
- `watchLeaveBalance()`: ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼

**ê·¼ë¬´ ìŠ¤ì¼€ì¤„ ê´€ë¦¬:**
- `createWorkSchedule()`: ìŠ¤ì¼€ì¤„ ìƒì„±
- `getScheduleForDate()`: íŠ¹ì • ë‚ ì§œ ìŠ¤ì¼€ì¤„
- `getActiveSchedules()`: í™œì„± ìŠ¤ì¼€ì¤„ ëª©ë¡
- `updateWorkSchedule()`: ìŠ¤ì¼€ì¤„ ìˆ˜ì •
- `deactivateSchedule()`: ìŠ¤ì¼€ì¤„ ë¹„í™œì„±í™”

---

### Phase 2: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì„œë¹„ìŠ¤ âœ…

#### 1. AttendanceService êµ¬í˜„

**ì¶œí‡´ê·¼ ê´€ë¦¬:**

```dart
// ì²´í¬ì¸
Future<CheckInResult> checkIn({
  required int employeeId,
  String? note,
  String? location,
})
```
- ì¤‘ë³µ ì¶œê·¼ ë°©ì§€
- ìŠ¤ì¼€ì¤„ í™•ì¸ (ê·¼ë¬´ì¼/íœ´ë¬´ì¼)
- ì§€ê° ì—¬ë¶€ ìë™ íŒë‹¨ (ì‹œì‘ ì‹œê°„ + 15ë¶„ ê¸°ì¤€)
- ìœ„ì¹˜ ì •ë³´ ë° ë©”ëª¨ ê¸°ë¡

```dart
// ì²´í¬ì•„ì›ƒ
Future<CheckOutResult> checkOut({
  required int employeeId,
  String? note,
})
```
- ê·¼ë¬´ ì‹œê°„ ìë™ ê³„ì‚° (ì´/ì •ê·œ/ì—°ì¥/ì•¼ê°„)
- ì¡°í‡´ ì—¬ë¶€ ìë™ íŒë‹¨ (ì¢…ë£Œ ì‹œê°„ - 30ë¶„ ê¸°ì¤€)
- ì™„ë£Œ ìƒíƒœë¡œ ì—…ë°ì´íŠ¸

**ê·¼ë¬´ ì‹œê°„ ê³„ì‚° ë¡œì§:**

```dart
WorkTimeBreakdown calculateWorkTime({
  required DateTime checkIn,
  required DateTime checkOut,
  required DateTime scheduledStart,
  required DateTime scheduledEnd,
})
```
- **ì •ê·œ ê·¼ë¬´**: ìŠ¤ì¼€ì¤„ ê¸°ì¤€ ì‹œê°„ (ìµœëŒ€)
- **ì—°ì¥ ê·¼ë¬´**: ìŠ¤ì¼€ì¤„ ì¢…ë£Œ í›„ ê·¼ë¬´ ì‹œê°„
- **ì•¼ê°„ ê·¼ë¬´**: 22:00 ~ 06:00 ì‚¬ì´ ê·¼ë¬´ ì‹œê°„

**íœ´ê°€ ê´€ë¦¬ ì›Œí¬í”Œë¡œìš°:**

```dart
// íœ´ê°€ ì‹ ì²­
Future<LeaveRequestResult> requestLeave({
  required int employeeId,
  required String leaveType,
  required DateTime startDate,
  required DateTime endDate,
  required String reason,
})
```
- íœ´ê°€ ì¼ìˆ˜ ìë™ ê³„ì‚° (ì£¼ë§ ì œì™¸)
- ì”ì—¬ì¼ ê²€ì¦
- ì¤‘ë³µ ì‹ ì²­ ë°©ì§€

```dart
// íœ´ê°€ ìŠ¹ì¸
Future<bool> approveLeave({
  required int requestId,
  required int approverId,
  String? note,
})
```
- ìƒíƒœ ì—…ë°ì´íŠ¸
- íœ´ê°€ ì”ì—¬ì¼ ìë™ ì°¨ê°
- í•´ë‹¹ ê¸°ê°„ absent ë¡œê·¸ ìë™ ìƒì„±

```dart
// íœ´ê°€ ê±°ì ˆ
Future<bool> rejectLeave({
  required int requestId,
  required int approverId,
  String? note,
})
```

**í†µê³„ ë° ë¦¬í¬íŠ¸:**

```dart
Future<MonthlyAttendanceReport> getMonthlyReport(
  int employeeId,
  int year,
  int month,
)
```
ë°˜í™˜ ì •ë³´:
- ì´ ê·¼ë¬´ì¼ vs ì‹¤ì œ ê·¼ë¬´ì¼
- ê²°ê·¼/ì§€ê°/ì¡°í‡´ ì¼ìˆ˜
- ì´ ê·¼ë¬´ ì‹œê°„ / ì—°ì¥ ê·¼ë¬´ / ì•¼ê°„ ê·¼ë¬´
- ìƒíƒœë³„ í†µê³„

```dart
Future<List<AttendanceLog>> getLateEmployees(DateTime date)
Future<List<AttendanceLog>> getAbsentEmployees(DateTime date)
```

**ìë™í™” ë°°ì¹˜ ì‘ì—… (êµ¬ì¡° ì¤€ë¹„):**
- `autoCheckOutMissing()`: ë¯¸ì²´í¬ì•„ì›ƒ ìë™ ì²˜ë¦¬
- `processAbsentees()`: ê²°ê·¼ì ìë™ ê¸°ë¡
- `createAbsentLogsForLeaves()`: íœ´ê°€ì absent ë¡œê·¸ ìƒì„±

#### 2. Providers ì„¤ì •
```dart
final attendanceDaoProvider = Provider<AttendanceDao>((ref) {
  return ref.watch(databaseProvider).attendanceDao;
});

final attendanceServiceProvider = Provider<AttendanceService>((ref) {
  final dao = ref.watch(attendanceDaoProvider);
  return AttendanceService(dao);
});
```

---

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### 1. ì¶œí‡´ê·¼ ê´€ë¦¬
- âœ… ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ ê¸°ëŠ¥
- âœ… ì§€ê°/ì¡°í‡´ ìë™ íƒì§€ (Â±15ë¶„, Â±30ë¶„ ê¸°ì¤€)
- âœ… ìœ„ì¹˜ ì •ë³´ ê¸°ë¡
- âœ… ë©”ëª¨ ê¸°ëŠ¥
- âœ… ì¤‘ë³µ ì¶œê·¼ ë°©ì§€

### 2. ê·¼ë¬´ ì‹œê°„ ê³„ì‚°
- âœ… ì´ ê·¼ë¬´ ì‹œê°„
- âœ… ì •ê·œ ê·¼ë¬´ ì‹œê°„ (ìŠ¤ì¼€ì¤„ ê¸°ì¤€)
- âœ… ì—°ì¥ ê·¼ë¬´ ì‹œê°„ (ìŠ¤ì¼€ì¤„ ì´ˆê³¼)
- âœ… ì•¼ê°„ ê·¼ë¬´ ì‹œê°„ (22:00~06:00)

### 3. íœ´ê°€ ê´€ë¦¬
- âœ… íœ´ê°€ ì‹ ì²­ (ì—°ì°¨/ë³‘ê°€/ê°œì¸/ì¶œì‚°/ìœ¡ì•„/ë¬´ê¸‰)
- âœ… ìŠ¹ì¸/ê±°ì ˆ ì›Œí¬í”Œë¡œìš°
- âœ… íœ´ê°€ ì¼ìˆ˜ ìë™ ê³„ì‚° (ì£¼ë§ ì œì™¸)
- âœ… ì”ì—¬ì¼ ê²€ì¦ ë° ìë™ ì°¨ê°
- âœ… ì¤‘ë³µ ì‹ ì²­ ë°©ì§€
- âœ… íœ´ê°€ ê¸°ê°„ absent ë¡œê·¸ ìë™ ìƒì„±

### 4. ê·¼ë¬´ ìŠ¤ì¼€ì¤„
- âœ… ìš”ì¼ë³„ ê·¼ë¬´ ì‹œê°„ ì„¤ì •
- âœ… ì‹œí”„íŠ¸ ê´€ë¦¬ (ì£¼ê°„/ì•¼ê°„/íœ´ë¬´)
- âœ… ìœ íš¨ ê¸°ê°„ ê´€ë¦¬

### 5. í†µê³„ ë° ë¦¬í¬íŠ¸
- âœ… ì›”ê°„ ê·¼íƒœ ë¦¬í¬íŠ¸
- âœ… ê·¼ë¬´ ì‹œê°„ í†µê³„
- âœ… ì§€ê°/ì¡°í‡´/ê²°ê·¼ í†µê³„
- âœ… ìƒíƒœë³„ ì§‘ê³„

---

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
lib/features/attendance/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ attendance_dao.dart         # DAO ë ˆì´ì–´
â”‚   â””â”€â”€ attendance_dao.g.dart       # ìƒì„±ëœ ì½”ë“œ
â””â”€â”€ domain/
    â””â”€â”€ services/
        â””â”€â”€ attendance_service.dart  # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

lib/database/
â”œâ”€â”€ tables/
â”‚   â”œâ”€â”€ attendance_logs.dart        # ì¶œí‡´ê·¼ ê¸°ë¡ í…Œì´ë¸”
â”‚   â”œâ”€â”€ leave_requests.dart         # íœ´ê°€ ì‹ ì²­ í…Œì´ë¸”
â”‚   â”œâ”€â”€ work_schedules.dart         # ê·¼ë¬´ ìŠ¤ì¼€ì¤„ í…Œì´ë¸”
â”‚   â””â”€â”€ leave_balances.dart         # íœ´ê°€ ì”ì—¬ í…Œì´ë¸”
â””â”€â”€ app_database.dart               # ë°ì´í„°ë² ì´ìŠ¤ (v7)

docs/
â”œâ”€â”€ 02-design/
â”‚   â””â”€â”€ employee-attendance-design.md        # ì„¤ê³„ ë¬¸ì„œ
â””â”€â”€ 03-implementation/
    â””â”€â”€ attendance-implementation-summary.md # êµ¬í˜„ ìš”ì•½ (ì´ ë¬¸ì„œ)
```

---

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

- **Flutter**: 3.10.8+
- **Riverpod**: 2.5.1 (ìƒíƒœ ê´€ë¦¬)
- **Drift**: 2.16.0 (SQLite ORM)
- **íŒ¨í„´**: Repository Pattern, Service Layer

---

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„ (Phase 3-5)

### Phase 3: ì§ì›ìš© UI (ì˜ˆì •)
- [ ] ì²´í¬ì¸/ì²´í¬ì•„ì›ƒ í™”ë©´
- [ ] ê·¼íƒœ ê¸°ë¡ í™”ë©´
- [ ] íœ´ê°€ ì‹ ì²­ í™”ë©´
- [ ] íœ´ê°€ ì”ì—¬ í‘œì‹œ

### Phase 4: ê´€ë¦¬ììš© UI (ì˜ˆì •)
- [ ] ê·¼íƒœ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ
- [ ] ì§ì›ë³„ ê·¼íƒœ í˜„í™©
- [ ] íœ´ê°€ ìŠ¹ì¸ í™”ë©´
- [ ] í†µê³„ ë° ë¦¬í¬íŠ¸

### Phase 5: í†µí•© ë° í…ŒìŠ¤íŠ¸ (ì˜ˆì •)
- [ ] ê¶Œí•œ ê´€ë¦¬ (ì§ì›/ê´€ë¦¬ì)
- [ ] ì•Œë¦¼ ì‹œìŠ¤í…œ ì—°ë™
- [ ] ì—£ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸
- [ ] ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì§€ì›

---

## ğŸš€ ë¹Œë“œ ìƒíƒœ

```bash
âœ… Drift ì½”ë“œ ìƒì„± ì™„ë£Œ (158 outputs)
âœ… Flutter analyze í†µê³¼ (0 errors, 10 warnings - unused imports only)
âœ… Database migration v6 â†’ v7 ì„±ê³µ
âœ… ëª¨ë“  í…Œì´ë¸” ë° ì¸ë±ìŠ¤ ìƒì„± ì™„ë£Œ
âœ… ì´ˆê¸° ë°ì´í„° ì‹œë”© ì™„ë£Œ
```

---

## ğŸ’¡ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™

### ì§€ê°/ì¡°í‡´ ê¸°ì¤€
- **ì§€ê°**: ìŠ¤ì¼€ì¤„ ì‹œì‘ ì‹œê°„ + 15ë¶„ ì´í›„ ì¶œê·¼
- **ì¡°í‡´**: ìŠ¤ì¼€ì¤„ ì¢…ë£Œ ì‹œê°„ - 30ë¶„ ì´ì „ í‡´ê·¼

### ê·¼ë¬´ ì‹œê°„ ë¶„ë¥˜
- **ì •ê·œ ê·¼ë¬´**: ìŠ¤ì¼€ì¤„ ê¸°ì¤€ ì‹œê°„ (ìµœëŒ€)
- **ì—°ì¥ ê·¼ë¬´**: ìŠ¤ì¼€ì¤„ ì¢…ë£Œ ì‹œê°„ ì´í›„ ê·¼ë¬´
- **ì•¼ê°„ ê·¼ë¬´**: 22:00 ~ 06:00 ì‚¬ì´ ê·¼ë¬´

### íœ´ê°€ ì¼ìˆ˜ ê³„ì‚°
- ì£¼ë§(í† /ì¼) ì œì™¸
- ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ ëª¨ë‘ í¬í•¨
- 0.5ì¼ ë‹¨ìœ„ ì§€ì›

### ê¸°ë³¸ íœ´ê°€ ë¶€ì—¬
- **ì—°ì°¨**: 15ì¼
- **ë³‘ê°€**: 5ì¼
- **ê°œì¸ ì‚¬ìœ **: 3ì¼

---

## ğŸ“Œ ì°¸ê³  ì‚¬í•­

1. **ê¶Œí•œ ê´€ë¦¬**: ì§ì›ì€ ë³¸ì¸ ê¸°ë¡ë§Œ ì¡°íšŒ, ê´€ë¦¬ìëŠ” ì „ì²´ ì¡°íšŒ ë° ìŠ¹ì¸ ê°€ëŠ¥
2. **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸**: Riverpod StreamProviderë¡œ ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”
3. **ë°ì´í„° ë¬´ê²°ì„±**: Foreign Key Cascade ì„¤ì •ìœ¼ë¡œ ì§ì› ì‚­ì œ ì‹œ ê´€ë ¨ ë°ì´í„° ìë™ ì‚­ì œ
4. **í™•ì¥ì„±**: ì‹œí”„íŠ¸ ê·¼ë¬´, ì—¬ëŸ¬ ë§¤ì¥, ì™¸ê·¼/ì¬íƒ êµ¬ë¶„ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„
5. **ì˜¤í”„ë¼ì¸ ì§€ì›**: ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì¤€ë¹„ ì™„ë£Œ

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] ì„¤ê³„ ë¬¸ì„œ ì‘ì„±
- [x] ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ìƒì„±
- [x] ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ (v6â†’v7)
- [x] AttendanceDao êµ¬í˜„
- [x] AttendanceService êµ¬í˜„
- [x] ì´ˆê¸° ë°ì´í„° ì‹œë”©
- [x] Riverpod Providers ì„¤ì •
- [x] ë¹Œë“œ ê²€ì¦
- [ ] ì§ì›ìš© UI êµ¬í˜„
- [ ] ê´€ë¦¬ììš© UI êµ¬í˜„
- [ ] í†µí•© í…ŒìŠ¤íŠ¸

---

**êµ¬í˜„ ì™„ë£Œ**: Phase 1-2 (ë°ì´í„°ë² ì´ìŠ¤ + ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
**ë‹¤ìŒ êµ¬í˜„**: Phase 3 (ì§ì›ìš© UI)
